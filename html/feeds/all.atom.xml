<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>notesalexp.org</title><link href="http://notesalexp.org/html/" rel="alternate"></link><link href="http://notesalexp.org/html/feeds/all.atom.xml" rel="self"></link><id>http://notesalexp.org/html/</id><updated>2016-05-19T10:40:00+03:00</updated><entry><title>Сборка truecrypt в Debian/Ubuntu.</title><link href="http://notesalexp.org/html/2016/05/19/truecrypt/" rel="alternate"></link><published>2016-05-19T10:40:00+03:00</published><author><name>Aлексанр Поздняков</name></author><id>tag:notesalexp.org,2016-05-19:html/2016/05/19/truecrypt/</id><summary type="html">&lt;p&gt;Эта статья написана для тех кто не хочет использовать сторонние сборки
с различных репозиториев, или собранные сторонними людьми.&lt;/p&gt;
&lt;p&gt;Итак приступим:&lt;/p&gt;
&lt;p&gt;Нам необходимо скачать исходные коды &lt;em&gt;TrueCrypt&lt;/em&gt;. Так как разработка официально закрыта и их нельзя скачать с  &lt;a href="http://www.truecrypt.org/"&gt;http://www.truecrypt.org/&lt;/a&gt;. Нам придется их качать с 
других мест. Для примера приведу несколько:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://github.com/DrWhax/truecrypt-archive"&gt;https://github.com/DrWhax/truecrypt-archive&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.grc.com/misc/truecrypt/truecrypt.htm"&gt;https://www.grc.com/misc/truecrypt/truecrypt.htm&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Скачиваем файл &lt;em&gt;TrueCrypt 7.1a Source.tar.gz&lt;/em&gt; прежде чем распаковать его, мы можем &lt;a href="https://github.com/DrWhax/truecrypt-archive#verifying-the-integrity"&gt;проверить цифровую подпись&lt;/a&gt; и контрольную сумму файла. &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;SHA256
=======
e6214e911d0bbededba274a2f8f8d7b3f6f6951e20f1c3a598fc7a23af81c8dc  TrueCrypt 7.1a Source.tar.gz
3de1be6ff4793c5d7269384a5739bb4c985068b15978d17d5bd71403e0f02177  TrueCrypt 7.1a Source.tar.gz.sig

SHA1
=======
d43e0dbe05c04e316447d87413c4f74c68f5de24  TrueCrypt 7.1a Source.tar.gz
caeb2bb1d5605d1fc960e936a06e52611033788c  TrueCrypt 7.1a Source.tar.gz.sig

MD5
=======
102d9652681db11c813610882332ae48  TrueCrypt 7.1a Source.tar.gz
5bca3d15b35d0725ff3317e568062ad8  TrueCrypt 7.1a Source.tar.gz.sig
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Так как в &lt;em&gt;Debian GNU/Linux&lt;/em&gt; начиная с версии 8 и в &lt;em&gt;Ubuntu&lt;/em&gt; начиная с версии 16.04 не предоставляется библиотека &lt;em&gt;wxWidgets&lt;/em&gt; версии 2.8 необходимая для сборки &lt;em&gt;TrueCrypt&lt;/em&gt;. Заходим на сайт &lt;a href="https://www.wxwidgets.org/downloads/"&gt;https://www.wxwidgets.org/downloads/&lt;/a&gt; качаем исходники версии 2.8.12:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wget https://github.com/wxWidgets/wxWidgets/releases/download/v2.8.12/wxWidgets-2.8.12.tar.gz
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Распакуем архивы в любую директорию например /home/user/build&lt;/p&gt;
&lt;p&gt;Так же нам понадобится заголовочный файлы &lt;em&gt;PKCS#11&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /home/user/build
mkdir pkcs11
&lt;span class="nb"&gt;cd&lt;/span&gt; pkcs11
wget ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-11/v2-20/pkcs11.h
wget ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-11/v2-20/pkcs11f.h
wget ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-11/v2-20/pkcs11t.h
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Удовлетворим зависимости для сборки&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo aptitude install build-essential libgtk2.0-dev libfuse-dev fuse-utils mount dmsetup libsm6  nasm pkg-config libsm-dev
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Переходим в папку &lt;em&gt;/home/user/build/truecrypt-7.1a-source&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Переносим исходники &lt;em&gt;wxWidgets&lt;/em&gt; и заголовочный файлы &lt;em&gt;PKCS#11&lt;/em&gt; в &lt;em&gt;/home/user/build/truecrypt-7.1a-source&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mv ../wxWidgets-2.8.12 .
mv ../pkcs11 .
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь самое интересное TrueCrypt не может монтировать разделы, если его собрать с помощью &lt;em&gt;gcc-5.x.&lt;/em&gt; Связанно с изменением C++ ABI.&lt;/p&gt;
&lt;p&gt;Проверяем версию gcc:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gcc --version                                                                                                                       
gcc (Debian 4.9.2-10) 4.9.2
Copyright (C) 2014 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если у нас в системе версия gcc 5.x. и выше, ставим gcc 4.9 и экспортируем переменные &lt;em&gt;CC&lt;/em&gt; и &lt;em&gt;CXX&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo aptitude install gcc-4.9 g++-4.9
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;CC&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;gcc-4.9
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;CXX&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;g++-4.9
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь определим еще две переменные PKCS11_INC и WX_ROOT&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PKCS11_INC&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/user/build/truecrypt-7.1a-source/pkcs11
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;WX_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/user/build/truecrypt-7.1a-source/wxWidgets-2.8.12
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для сборки нам необходимо подправить строку &lt;em&gt;108&lt;/em&gt; в файле &lt;em&gt;Main/Main.make&lt;/em&gt;, 
что бы линковка завершилась без ошибок, привести к такому виду &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="k"&gt;$(&lt;/span&gt;CXX&lt;span class="k"&gt;)&lt;/span&gt; -o &lt;span class="k"&gt;$(&lt;/span&gt;APPNAME&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;LFLAGS&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;OBJS&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;LIBS&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;FUSE_LIBS&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;WX_LIBS&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;EXTRA_LIBS&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Определим переменную &lt;em&gt;EXTRA_LIBS&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;EXTRA_LIBS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-lX11 -ldl&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Собираем библиотеку &lt;em&gt;wxWidgets&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;make wxbuild
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Собираем &lt;em&gt;TrueCrypt&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;make &lt;span class="nv"&gt;WXSTATIC&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Копируем truecrypt в /usr/local/bin&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo cp Main/truecrypt /usr/local/bin/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Запускаем и пользуемся&lt;/p&gt;</summary><category term="truecrypt"></category><category term="make"></category></entry></feed>